rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /playlists/{docId} {
      // Any authenticated user can read any playlist.
      allow read: if request.auth != null;

      // An authenticated user can create a playlist, but only if they set
      // the 'userId' field to their own unique ID.
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      
      // Only the owner of the playlist can update it (e.g., add songs).
      allow update: if request.auth != null && request.auth.uid == resource.data.userId;

      // Only the owner can delete their own playlist.
      // Your previous rule to only allow deletion of empty playlists is preserved.
      allow delete: if request.auth != null && request.auth.uid == resource.data.userId && resource.data.songs.size() == 0;
    }
  }
}